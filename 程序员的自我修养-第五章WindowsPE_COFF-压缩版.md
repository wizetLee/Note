第五章：WindowsPE/COFF


- 5.1 Windows的二进制文件格式PE/COFF

- 5.2 PE的前身--COFF

    - COFF和ELF文件一样也是由文件头以及后面的若干段组成，再加上文件尾部的符号表、调试信息的内容。COFF文件包括两部分，一个是描述该文件总结构和属性的`映像头（Image Header）`，另一个是描述该文件中包含的段属性的段表（Section Table）。

        - `映像（Image），因为PE文件在装载时被直接映射到进程的虚拟空间中运行，它是进程的虚拟空间的映像。所以PE可执行文件很多时候被叫做映像文件（Image File）。`

    - 文件头为一个IMAGE_FILE_HEADER的结构、映像头后面紧跟着就是COFF文件的段表，类型为IMAGE_SECTION_HEADER结构的数组，每个元素代表一个段。（段属性有：段名、物理地址、虚拟地址、原始数据大小、段在文件中的位置、段的重定位表在文件中的位置、段的行号表在文件中的位置、标志位（Characteristics，段的属性，包含主要的段的类型（代码、数据、bss）、对齐方式以及可读可写可执行等权限）等等）

    - 段表后就是一个个段的实际内容


- 5.7 总结

    Windows下的可执行文件和目标文件格式PE/COFF。PE/COFF文件与ELF文件非常相似，都是基于段的结构的二进制文件格式。Windows下最常见的目标文件格式就是COFF文件格式，微软的编译器产生的目标文件都是这种格式。COFF文件中有一个很有意思的的段叫做".drectve段"，这个段中保存的是编译器传递给链接器的命令行参数，可以通过这个段实现指定运行库等功能。

    